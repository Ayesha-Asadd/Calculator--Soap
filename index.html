<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Basic Calculator (SOAP)</title>
<style>
  :root{
    --bg:#3b3b3b;
    --panel:#dfe1e3;
    --btn:#ffffff;
    --btn-shadow: #bebfc1;
    --op-btn:#222;
    --op-text:#fff;
    --accent:#c62828; /* red for C */
    --display-bg:#f6f7f8;
    --display-text:#222;
  }

  html,body{
    height:100%;
    margin:0;
    font-family: "Helvetica Neue", Arial, sans-serif;
    background: #2f2f2f;
    display:flex;
    align-items:center;
    justify-content:center;
  }

  .wrapper{
    width: 260px;
    background: linear-gradient(#bfc3c7, #e6e7e8);
    border-radius: 10px;
    padding: 18px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.45), inset 0 2px 0 rgba(255,255,255,0.6);
  }

  h1.title{
    margin:0 0 10px 0;
    font-size:18px;
    text-align:center;
    color:#333;
    letter-spacing:0.6px;
    font-weight:700;
  }

  .calc {
    background: var(--panel);
    border-radius: 8px;
    padding: 12px;
    box-shadow: inset 0 -4px 8px rgba(0,0,0,0.08);
  }

  .display {
    height:44px;
    background: var(--display-bg);
    border-radius:6px;
    box-shadow: inset 0 2px 6px rgba(0,0,0,0.12);
    display:flex;
    align-items:center;
    justify-content:flex-end;
    padding: 6px 12px;
    font-size:24px;
    color: var(--display-text);
    margin-bottom:12px;
    overflow:hidden;
  }

  /* keypad grid */
 .keys {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 10px;
}

.zero {
  grid-column: span 1; /* no longer span 2 */
}

  button.key {
    appearance:none;
    -webkit-appearance:none;
    border: none;
    outline: none;
    background: var(--btn);
    height:46px;
    border-radius:6px;
    box-shadow: 0 3px 0 var(--btn-shadow), inset 0 1px 0 rgba(255,255,255,0.6);
    font-size:18px;
    font-weight:700;
    color:#222;
    touch-action: manipulation;
  }

  button.key:active{
    transform: translateY(2px);
    box-shadow: 0 1px 0 var(--btn-shadow);
  }

  /* operator column darker */
  button.op {
    background: var(--op-btn);
    color: var(--op-text);
    box-shadow: 0 3px 0 rgba(0,0,0,0.6);
  }

  button.clear {
    background: var(--accent);
    color: white;
    box-shadow: 0 3px 0 rgba(0,0,0,0.35);
  }

  

  /* equals button style (dark) */
  .equals {
    background: #333;
    color: white;
    box-shadow: 0 3px 0 rgba(0,0,0,0.6);
  }

  /* small status line */
  .status {
    margin-top:10px;
    text-align:center;
    font-size:12px;
    color:#444;
    min-height:16px;
  }

  /* responsive touch size */
  @media (max-width:360px){
    .wrapper { transform: scale(0.95); }
  }
</style>
</head>
<body>

<div class="wrapper" role="application" aria-label="Basic Calculator">
  <h1 class="title">Basic Calculator</h1>

  <div class="calc">
    <div id="display" class="display" aria-live="polite">0</div>

    <div class="keys" role="group" aria-label="Calculator keys">
  <!-- row 1 -->
  <button class="key clear" id="clear">C</button>
  <button class="key" data-action="digit" data-value="7">7</button>
  <button class="key" data-action="digit" data-value="8">8</button>
  <button class="key op" data-action="op" data-value="/">÷</button>

  <!-- row 2 -->
  <button class="key" data-action="digit" data-value="4">4</button>
  <button class="key" data-action="digit" data-value="5">5</button>
  <button class="key" data-action="digit" data-value="6">6</button>
  <button class="key op" data-action="op" data-value="*">×</button>

  <!-- row 3 -->
  <button class="key" data-action="digit" data-value="1">1</button>
  <button class="key" data-action="digit" data-value="2">2</button>
  <button class="key" data-action="digit" data-value="3">3</button>
  <button class="key op" data-action="op" data-value="-">−</button>

  <!-- row 4 (modified) -->
  <button class="key zero" data-action="digit" data-value="0">0</button>
  <button class="key" data-action="dot" data-value=".">.</button>
  <button class="key equals" id="equals" data-action="equals">=</button>
  <button class="key op" data-action="op" data-value="+">+</button>
</div>


    <div class="status" id="status" aria-hidden="false"></div>
  </div>
</div>

<script>
/*
  Calculator behavior:
  - Numbers and dot build the current input.
  - Pressing an operator stores the current value and chosen op.
  - Pressing = sends a SOAP request to the Calculator API (Add/Subtract/Multiply/Divide)
    with the stored value and current input, then shows the response.
  - 'C' clears everything.
  - All operations use the same SOAP API endpoints (so functionality remains unchanged).
  - NOTE: The SOAP API expects numeric values (integers work best). Division from the API is integer division.
*/

/* --- Config: CORS proxy and target --- */
// If you run into CORS issues, use a proxy. Example below uses cors-anywhere.
// To use cors-anywhere you may need to visit https://cors-anywhere.herokuapp.com/corsdemo and request access.
const useProxy = true;
const corsProxy = "https://corsproxy.io/?";
const targetUrl = "http://www.dneonline.com/calculator.asmx";
const soapBaseUrl = (useProxy ? corsProxy + encodeURIComponent(targetUrl) : targetUrl);
/* --- State --- */
let displayEl = document.getElementById('display');
let statusEl = document.getElementById('status');

let currentInput = "0";       // string for the number being entered
let storedValue = null;       // string or number stored when op is pressed
let pendingOp = null;         // one of: Add, Subtract, Multiply, Divide
let entering = true;          // true when building a number

/* helpers */
function updateDisplay(text) {
  // limit length
  const str = String(text);
  if (str.length > 12) {
    displayEl.textContent = Number(str).toPrecision(10);
  } else {
    displayEl.textContent = str;
  }
}

/* map operator symbol to SOAP operation name */
function opToSoap(opSymbol){
  switch(opSymbol){
    case '+': return 'Add';
    case '-': return 'Subtract';
    case '*': return 'Multiply';
    case '/': return 'Divide';
    default: return null;
  }
}

/* build SOAP XML body */
function buildSoapEnvelope(operation, a, b){
  return `<?xml version="1.0" encoding="utf-8"?>
  <soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                 xmlns:xsd="http://www.w3.org/2001/XMLSchema"
                 xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">
    <soap:Body>
      <${operation} xmlns="http://tempuri.org/">
        <intA>${a}</intA>
        <intB>${b}</intB>
      </${operation}>
    </soap:Body>
  </soap:Envelope>`;
}

/* send SOAP POST and parse result */
async function callSoapOperation(operationName, a, b){
  statusEl.textContent = '⏳ Fetching...';
  try {
    const body = buildSoapEnvelope(operationName, a, b);
    const resp = await fetch(soapBaseUrl, {
      method: 'POST',
      headers: {
        "Content-Type": "text/xml; charset=utf-8",
        "SOAPAction": `http://tempuri.org/${operationName}`
      },
      body: body
    });

    if(!resp.ok){
      throw new Error('HTTP ' + resp.status);
    }

    const text = await resp.text();
    const parser = new DOMParser();
    const xml = parser.parseFromString(text, "text/xml");
    const tag = xml.getElementsByTagName(`${operationName}Result`)[0];
    if(!tag){
      throw new Error('Invalid SOAP response');
    }
    statusEl.textContent = '✔ Done';
    return tag.textContent;
  } catch (err){
    statusEl.textContent = '❌ ' + err.message;
    throw err;
  }
}

/* number button pressed */
function onDigit(d){
  if(!entering){
    currentInput = d === '.' ? '0.' : d;
    entering = true;
  } else {
    if(d === '.' && currentInput.includes('.')) return;
    if(currentInput === '0' && d !== '.') currentInput = d;
    else currentInput = currentInput + d;
  }
  updateDisplay(currentInput);
}

/* operator pressed */
function onOperator(sym){
  // if user presses op in succession, just update op
  if(pendingOp && !entering){
    pendingOp = sym;
    statusEl.textContent = `Op set to ${sym}`;
    return;
  }

  // store current input
  storedValue = currentInput;
  pendingOp = sym;
  entering = false;
  statusEl.textContent = `Op set to ${sym}`;
  updateDisplay(sym);
}

/* equals pressed */
async function onEquals(){
  if(!pendingOp || storedValue === null){
    statusEl.textContent = '⚠ No operation selected';
    return;
  }

  // Use storedValue and currentInput as operands
  // SOAP service expects numbers (use as-is). We'll pass them as-is; API uses integer semantics.
  const opName = opToSoap(pendingOp);
  if(!opName){
    statusEl.textContent = '⚠ Unsupported op';
    return;
  }

  // show interim
  statusEl.textContent = '⏳ Sending to SOAP...';
  try {
    // send numbers — trim to avoid huge strings
    const a = storedValue;
    const b = currentInput;
    const result = await callSoapOperation(opName, a, b);
    currentInput = String(result);
    updateDisplay(currentInput);
    // clear pending
    storedValue = null;
    pendingOp = null;
    entering = false;
  } catch (err){
    // error already set in status
  }
}

/* clear */
function onClear(){
  currentInput = "0";
  storedValue = null;
  pendingOp = null;
  entering = true;
  updateDisplay(currentInput);
  statusEl.textContent = '';
}

/* wire buttons */
document.querySelectorAll('button.key').forEach(btn => {
  btn.addEventListener('click', (e) => {
    const action = btn.dataset.action;
    const value = btn.dataset.value;
    if(action === 'digit'){
      onDigit(value);
    } else if (action === 'dot'){
      onDigit('.');
    } else if (action === 'op'){
      onOperator(value);
    } else if (action === 'equals'){
      onEquals();
    } else if (btn.id === 'clear'){
      onClear();
    }
  });

  // also support touch (fast)
  btn.addEventListener('touchstart', (ev) => {
    ev.preventDefault(); // prevent mouse event duplication
    btn.classList.add('pressed');
  }, {passive:false});
  btn.addEventListener('touchend', (ev) => {
    btn.classList.remove('pressed');
  });
});

/* initialize */
updateDisplay(currentInput);
statusEl.textContent = 'Ready';
</script>

</body>
</html>
